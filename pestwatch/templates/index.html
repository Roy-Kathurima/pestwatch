<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>PestWatch</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
  {% include "navbar.html" %}
  <div class="container">
    <div class="hero">
      <div>
        <h1>PestWatch</h1>
        <p class="small">Report pest incidents on your farm. Upload a photo, attach your location, and an admin will review.</p>
        <div style="margin-top:12px;">
          <a class="btn btn-primary" href="{{ url_for('login') }}">Login</a>
          <a class="btn btn-ghost" href="{{ url_for('register') }}">Register</a>
        </div>
      </div>
      <div style="flex:1;">
        <div id="index-map" class="map-box"></div>
      </div>
    </div>

    <h2 style="margin-top:18px;">Latest approved reports</h2>
    <div class="grid">
      <div>
        {% for r in reports %}
          <div class="card">
            <strong>{{ r.title or "Report" }}</strong>
            <div class="small">{{ r.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
            <p>{{ r.details[:200] }}{% if r.details and r.details|length > 200 %}...{% endif %}</p>
            {% if r.image_filename %}
              <img src="{{ url_for('uploads', filename=r.image_filename) }}" class="report-image">
            {% endif %}
          </div>
        {% else %}
          <div class="card">No approved reports yet.</div>
        {% endfor %}
      </div>
      <div>
        <div class="card">
          <h3>About</h3>
          <p class="small">PestWatch helps smallholder farmers report pest outbreaks and enables extension officers to respond.</p>
        </div>
        <div class="card">
          <h3>Admin</h3>
          <p class="small">Admins unlock via secret code (linked at top). Use the admin panel to approve reports and export CSVs.</p>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const reports = {{ reports_json|tojson }};
  </script>
  <script src="{{ url_for('static', filename='js/map.js') }}"></script>
  <script>renderMap('index-map', reports);</script>
</body>
</html>
