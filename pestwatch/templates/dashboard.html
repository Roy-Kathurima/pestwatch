{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>Your Dashboard</h2>
  <p>Welcome, {{ current_user.username }}</p>
  <p><a href="{{ url_for('auth.report') }}">Submit new report</a></p>
</div>

<div class="card">
  <h3>Your Reports</h3>
  {% if reports %}
    <table>
      <tr><th>ID</th><th>Pest</th><th>Location</th><th>Photo</th><th>Date</th><th>Actions</th></tr>
      {% for r in reports %}
      <tr>
        <td>{{ r.id }}</td>
        <td>{{ r.pest_name }}</td>
        <td>{{ "%.6f"|format(r.latitude) }}, {{ "%.6f"|format(r.longitude) }}</td>
        <td>
          {% if r.image %}
            <a href="{{ url_for('uploaded_file', filename=r.image) }}" target="_blank">View</a>
          {% else %} - {% endif %}
        </td>
        <td>{{ r.created_at }}</td>
        <td>
          <a href="{{ url_for('auth.report_edit', rid=r.id) }}">Edit</a>
          <form action="{{ url_for('auth.report_delete', rid=r.id) }}" method="post" style="display:inline" onsubmit="return confirm('Delete?')">
            <button type="submit">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </table>
  {% else %}
    <p>No reports yet.</p>
  {% endif %}
</div>
{% endblock %}
