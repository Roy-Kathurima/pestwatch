{% include "navbar.html" %}

<div class="container">
  <h2>Submit Pest Report</h2>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form method="post" enctype="multipart/form-data">
    <label>Title:<br><input name="title" required></label><br><br>

    <label>Details:<br><textarea name="details" rows="4"></textarea></label><br><br>

    <label>Photo (optional):<br><input type="file" name="image" accept="image/*"></label><br><br>

    <div>
      <button type="button" class="btn" onclick="useDeviceLocation()">Use device location</button>
    </div><br>

    <label>Latitude:<br><input id="lat" name="lat"></label><br><br>
    <label>Longitude:<br><input id="lng" name="lng"></label><br><br>

    <div id="map" style="height:320px; border-radius:8px;"></div><br>

    <button class="btn-primary" type="submit">Submit Report</button>
  </form>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/geolocation.js') }}"></script>

<script>
  // initialize leaflet map for the form
  var map = L.map('map').setView([-1.286389,36.817223], 6);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  var deviceMarker;
  map.on('click', function(e){
    document.getElementById('lat').value = e.latlng.lat.toFixed(6);
    document.getElementById('lng').value = e.latlng.lng.toFixed(6);
    if(deviceMarker) deviceMarker.setLatLng(e.latlng); else deviceMarker = L.marker(e.latlng).addTo(map);
  });
</script>
