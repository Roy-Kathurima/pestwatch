{% extends "base.html" %}

{% block content %}

{% if not session.admin %}
<h2>Admin Login</h2>

<form method="POST">
    <label>Password:</label><br>
    <input type="password" name="password"><br><br>
    <button type="submit">Login</button>
</form>

{% else %}

<h2>Admin Dashboard</h2>
<p><strong>All Pest Reports (Map View)</strong></p>

<div id="map" style="height:500px;"></div>

<script>
  const map = L.map('map').setView([0.0, 37.0], 6);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
  }).addTo(map);

  fetch("{{ api_url }}")
    .then(r => r.json())
    .then(data => {
      data.forEach(item => {
        const marker = L.marker([item.lat, item.lon]).addTo(map);

        let popupContent = `<strong>${item.farmer_name || 'Farmer'}</strong><br>
                            ${item.description || ''}<br>
                            <small>${item.created_at}</small>`;

        if (item.image_url) {
            popupContent += `<br><img src="${item.image_url}" width="120">`;
        }

        marker.bindPopup(popupContent);
      });
    });
</script>

{% endif %}

{% endblock %}
