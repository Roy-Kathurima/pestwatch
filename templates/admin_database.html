<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin DB - PestWatch</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<div class="container">
  <h2>Database (admin view)</h2>

  <h3>Users</h3>
  <table class="db-table">
    <thead><tr><th>id</th><th>fullname</th><th>email</th><th>role</th><th>created_at</th></tr></thead>
    <tbody>
      {% for u in users %}
        <tr><td>{{ u.id }}</td><td>{{ u.fullname }}</td><td>{{ u.email }}</td><td>{{ u.role }}</td><td>{{ u.created_at }}</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <h3>Reports</h3>
  <table class="db-table">
    <thead><tr><th>id</th><th>title</th><th>user</th><th>lat</th><th>lon</th><th>status</th><th>created_at</th></tr></thead>
    <tbody>
      {% for r in reports %}
        <tr>
          <td>{{ r.id }}</td>
          <td>{{ r.title }}</td>
          <td>{{ r.user.email }}</td>
          <td>{{ r.latitude }}</td>
          <td>{{ r.longitude }}</td>
          <td>{{ r.status }}</td>
          <td>{{ r.created_at }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <h3>Login attempts (recent)</h3>
  <table class="db-table">
    <thead><tr><th>time</th><th>email</th><th>success</th><th>ip</th><th>role_attempt</th></tr></thead>
    <tbody>
      {% for a in attempts %}
        <tr>
          <td>{{ a.attempted_at }}</td>
          <td>{{ a.email }}</td>
          <td>{{ 'yes' if a.success else 'no' }}</td>
          <td>{{ a.ip }}</td>
          <td>{{ a.role_attempt }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <p><a href="{{ url_for('admin_dashboard') }}?pwd={{ request.args.get('pwd','') }}" class="btn">Back to admin dashboard</a></p>
</div>
</body>
</html>
