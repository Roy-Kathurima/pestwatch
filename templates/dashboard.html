<!DOCTYPE html>
<html>
<head>
  <title>Farmer Dashboard</title>
  <link rel="stylesheet" href="/static/css/style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>

<div class="box">
<h2>Welcome {{ user.name }}</h2>

<a class="btn" href="/report/new/{{ user.id }}">Add Report</a>

<h3>Your Reports</h3>

<table>
<tr><th>Pest</th><th>Description</th><th>Date</th></tr>
{% for r in reports %}
<tr>
<td>{{ r.pest }}</td>
<td>{{ r.desc }}</td>
<td>{{ r.date }}</td>
</tr>
{% endfor %}
</table>

</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
const reports = {{ reports | tojson }};

let map = L.map('map').setView([-1.286389, 36.817223], 6);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

reports.forEach(r => {
    if(r.lat && r.lng){
        L.marker([r.lat, r.lng])
        .addTo(map)
        .bindPopup("<b>" + r.pest + "</b><br>" + r.desc);
    }
});
</script>

</body>
</html>
